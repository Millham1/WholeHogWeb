<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Blind Taste Scoring</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="supabase-config.js"></script>
  <style>
    header.header { position: relative; height: 2.25in; min-height: 2.25in; line-height: normal; }
    header.header img#logoLeft { position:absolute; left:18px; top:50%; transform:translateY(-50%); height:calc(100% - 24px); width:auto; }
    header.header img.right-img { position:absolute; right:18px; top:50%; transform:translateY(-50%); height:calc(100% - 24px); width:auto; }
    header.header h1 { margin:0; text-align:center; position:absolute; left:0; right:0; top:50%; transform:translateY(-50%); }
    .page-wrap{max-width:1200px;margin:0 auto;padding:12px;}
    .panel{margin:10px 0;}
    .grid-two{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:14px;}
    .card{background:#fff;border:1px solid #ddd;border-radius:14px;padding:14px;}
    .row{display:grid;grid-template-columns:160px 1fr;gap:10px;align-items:center;margin:8px 0;}
    .score-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;}
    .mini-card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:10px;position:relative;min-height:96px;}
    .mini-head{font-weight:700;margin-bottom:8px;}
    .range{color:#666;font-weight:400;margin-left:4px;}
    .picker-btn{width:100%;padding:10px 12px;border:1px solid #bbb;border-radius:10px;background:#f8f8f8;cursor:pointer;font-weight:600;}
    .options{display:none;margin-top:8px;border-top:1px dashed #ddd;padding-top:8px;}
    .options.show{display:block;}
    .options .opt{margin:4px 4px 0 0;padding:6px 8px;border:1px solid #bbb;background:#fff;border-radius:8px;cursor:pointer;}
    .total-row{display:grid;grid-template-columns:60px 1fr auto;gap:10px;align-items:center;margin-top:12px;}
    .total-label{font-weight:700;}
    .total-val{font-weight:800;font-size:1.2rem;}
    .btn-primary{background:#0b4fff;color:#fff;border:0;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer;}
  </style>
</head>
<body>
  <header class="header">
    <img id="logoLeft" src="Legion whole hog logo.png" alt="Whole Hog">
    <h1>Blind Taste Scoring</h1>
    <img class="right-img" src="AL Medallion.png" alt="American Legion">
  </header>
  <div id="top-go-buttons" class="container" style="display:flex;gap:10px;align-items:center;justify-content:flex-start;margin-top:10px;margin-bottom:0;">
    <button type="button" class="btn btn-ghost" onclick="location.href='landing.html'">Go to Landing</button>
    <button type="button" class="btn btn-ghost" onclick="location.href='leaderboard.html'">Go to Leaderboard</button>
    <button type="button" class="btn btn-ghost" onclick="location.href='onsite.html'">Go to On-site</button>
    <button type="button" class="btn btn-ghost" onclick="location.href='sauce.html'">Go to Sauce Tasting</button>
  </div>
  <main class="page-wrap">
    <section class="panel">
      <div class="grid-two">
        <div class="card">
          <h2>Judge & Chip</h2>
          <div class="row">
            <label for="judgeSelect">Judge</label>
            <select id="judgeSelect"><option value="">Loading judges…</option></select>
          </div>
          <div class="row">
            <label for="chipSelect">Chip Number</label>
            <select id="chipSelect"><option value="">Loading chips…</option></select>
          </div>
        </div>
        <div class="card" id="scoringCard">
          <h2>Scores</h2>
          <div class="score-grid">
            <div class="mini-card" id="cardAppearance">
              <div class="mini-head">Appearance <span class="range">(2-40)</span></div>
              <button class="picker-btn" data-for="appearance"><span class="sel">Choose</span></button>
              <div class="options" data-for="appearance"></div>
            </div>
            <div class="mini-card" id="cardTenderness">
              <div class="mini-head">Tenderness <span class="range">(2-40)</span></div>
              <button class="picker-btn" data-for="tenderness"><span class="sel">Choose</span></button>
              <div class="options" data-for="tenderness"></div>
            </div>
            <div class="mini-card" id="cardTaste">
              <div class="mini-head">Taste <span class="range">(4-80)</span></div>
              <button class="picker-btn" data-for="taste"><span class="sel">Choose</span></button>
              <div class="options" data-for="taste"></div>
            </div>
          </div>
          <div class="total-row">
            <div class="total-label">Total</div>
            <div class="total-val" id="totalDisplay">0</div>
            <button id="saveBtn" class="btn-primary">Save</button>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script>
    // Helper functions for localStorage
    function getList(key, fallback=[]) { try { return JSON.parse(localStorage.getItem(key)||'[]'); } catch { return fallback; } }
    function uniqueClean(arr){return Array.from(new Set(arr.map(s=>String(s).trim()).filter(Boolean)));}
    function renderJudges(){
      let judges = getList('judgesList');
      if (!Array.isArray(judges) || judges.length === 0)
        judges = getList('wh_Judges');
      if (judges.length && typeof judges[0] === 'object')
        judges = judges.map(j => j.name).filter(Boolean);
      judges = uniqueClean(judges);
      var sel = document.getElementById('judgeSelect');
      sel.innerHTML = '<option value="">Select judge…</option>' + judges.map(j => `<option value="${j.replace(/"/g,'&quot;')}">${j}</option>`).join('');
    }
    function renderChips(){
      let chips = uniqueClean(getList('chipsList'));
      chips = chips.filter(x=>/^[\d]+$/.test(x)).sort((a,b)=>Number(a)-Number(b));
      var sel = document.getElementById('chipSelect');
      sel.innerHTML = '<option value="">Select chip…</option>' + chips.map(c => `<option value="${c.replace(/"/g,'&quot;')}">${c}</option>`).join('');
    }
    document.addEventListener('DOMContentLoaded', function(){
      renderJudges();
      renderChips();
    });
  </script>
  <script src="blind-sb.js"></script>
</body>
</html>
