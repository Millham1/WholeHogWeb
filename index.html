<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Whole Hog Competition 2025</title>
  <style>
    :root{
      --bg:#f7f9ff; --card:#fff; --ink:#111; --muted:#555;
      --blue:#083d8c; --white:#ffffff; --red:#b10020;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.4 -apple-system,BlinkMacSystemFont,"Segoe UI",Arial,system-ui;
      color:var(--ink);
      background:linear-gradient(180deg,#ffffff, #f1f4ff 35%, #eef2ff 100%);
      padding:16px;
    }
    .site-header{
      position:relative;
      display:flex; align-items:center; justify-content:space-between;
      height:140px; padding:0 16px;
      border-radius:16px;
      background:linear-gradient(90deg,var(--blue),var(--white) 50%,var(--red));
      box-shadow:0 6px 18px rgba(0,0,0,.12);
    }
    .logo-pig{ width:288px; height:auto; object-fit:contain; }
    .logo-medal{ width:144px; height:auto; object-fit:contain; }
    .site-header h1{
      position:absolute; left:50%; transform:translateX(-50%);
      margin:0; text-align:center;
      font-weight:800; font-size:38px; letter-spacing:.2px; color:#000;
      text-shadow:0 1px 0 rgba(255,255,255,.45);
    }
    .page{
      max-width:1200px; margin:20px auto; display:grid; gap:16px;
    }
    .toolbar{
      display:flex; gap:12px; justify-content:flex-end;
    }
    .btn{
      padding:10px 14px; border-radius:10px; border:1px solid #d9dbe7; background:#fff; cursor:pointer;
    }
    .btn.primary{ background:var(--blue); color:#fff; border-color:transparent; }
    .card{
      background:var(--card); border-radius:var(--radius);
      box-shadow:0 8px 18px rgba(0,0,0,.08);
      padding:16px;
    }
    .card h2{ margin:0 0 12px 0; font-size:20px }
    .grid-two{
      display:grid; grid-template-columns: 420px 1fr; gap:16px;
    }
    .fieldset{ display:grid; gap:10px; }
    label strong{ display:block; margin-bottom:4px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.5px }
    input[type="text"]{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d9dbe7; background:#fff;
    }
    .mini-list{
      display:grid; gap:8px; align-content:start; max-height:280px; overflow:auto; padding-right:4px;
    }
    .pill{
      display:flex; align-items:center; justify-content:space-between;
      gap:8px; padding:10px 12px; border:1px solid #e4e6f0; border-radius:12px; background:#fff;
    }
    .pill small{ color:var(--muted) }
    .pill .kill{ border:none; background:#f6f6fb; border-radius:8px; padding:6px 10px; cursor:pointer }
    .footer-note{ color:var(--muted); font-size:12px; }
  </style>
  <script type="module" src="wh-common.js"></script>
</head>
<body>
  <header class="site-header">
    <img class="logo-pig"   src="pig-rwb-1024.png" alt="Pig">
    <h1>Whole Hog Competition 2025</h1>
    <img class="logo-medal" src="AL Medallion.png" alt="American Legion">
  </header>

  <main class="page">
    <div class="toolbar">
      <a class="btn primary" href="index.html">Go to On-Site Scoring</a>
      <a class="btn" href="blind.html">Go to Blind Tasting</a>
    </div>

    <!-- Teams -->
    <section class="card">
      <h2>Teams</h2>
      <div class="grid-two">
        <div class="fieldset">
          <label><strong>Team name</strong><input id="teamName" type="text" placeholder="Team name"></label>
          <label><strong>Site #</strong><input id="teamSite" type="text" placeholder="e.g., 14"></label>
          <button class="btn primary" id="addTeam">Add Team</button>
          <div class="footer-note">Duplicates (by name or site) are ignored.</div>
        </div>
        <div>
          <div class="mini-list" id="teamList"></div>
        </div>
      </div>
    </section>

    <!-- Judges -->
    <section class="card">
      <h2>Judges</h2>
      <div class="grid-two">
        <div class="fieldset">
          <label><strong>Judge name</strong><input id="judgeName" type="text" placeholder="Judge name"></label>
          <button class="btn primary" id="addJudge">Add Judge</button>
        </div>
        <div>
          <div class="mini-list" id="judgeList"></div>
        </div>
      </div>
    </section>
  </main>

  <script src="landing.js"></script>
  <!-- WHOLEHOG SUPABASE START -->
  <script src="supabase-rest.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.whAutoWire) { try { window.whAutoWire(); } catch (e) { console.error(e); } }
    });
  </script>
  <!-- WHOLEHOG SUPABASE END -->
  <script type="module">
    /* WHOLEHOG LANDING WIRE (idempotent) */
    import { fetchTeams, fetchJudges, insertTeam, insertJudge, state } from "./wh-common.js";

    async function refreshLists(){
      // Teams list
      const teamList = document.querySelector("#teamList");
      if (teamList){
        const teams = await fetchTeams();
        teamList.innerHTML = "";
        for (const t of teams){
          const li = document.createElement("li");
          li.textContent = `${t.site_number} — ${t.name}`;
          li.style.cursor = "pointer";
          li.onclick = () => { state.lastTeam = t.id; highlight(teamList, li); };
          teamList.appendChild(li);
          if (t.id === state.lastTeam) setTimeout(()=>highlight(teamList, li), 0);
        }
      }
      // Judges list
      const judgeList = document.querySelector("#judgeList");
      if (judgeList){
        const judges = await fetchJudges();
        judgeList.innerHTML = "";
        for (const j of judges){
          const li = document.createElement("li");
          li.textContent = j.name;
          li.style.cursor = "pointer";
          li.onclick = () => { state.lastJudge = j.id; highlight(judgeList, li); };
          judgeList.appendChild(li);
          if (j.id === state.lastJudge) setTimeout(()=>highlight(judgeList, li), 0);
        }
      }
    }
    function highlight(ul, li){
      Array.from(ul.children).forEach(e=>e.classList.remove("selected"));
      li.classList.add("selected");
    }

    async function wireLanding(){
      // add a tiny style for selection if not present
      if (!document.querySelector("#wh-landing-style")){
        const s = document.createElement("style");
        s.id = "wh-landing-style";
        s.textContent = "ul li.selected{background:#eef;border-radius:6px;padding:2px 6px}";
        document.head.appendChild(s);
      }

      // Team form
      const tn = document.querySelector("#teamName");
      const ts = document.querySelector("#siteNumber");
      const btnTeam = document.querySelector("#btnSaveTeam");
      if (tn && ts && btnTeam){
        btnTeam.addEventListener("click", async (e)=>{
          e.preventDefault();
          const name = (tn.value||"”).trim();
          const site = (ts.value||"”).trim();
          if(!name || !site){ alert("Enter Team name and Site #"); return; }
          try {
            const rec = await insertTeam(name, site);
            if (rec && rec.id){ state.lastTeam = rec.id; }
            tn.value = ""; ts.value = "";
            await refreshLists();
          } catch(ex){ alert("Save team failed: " + (ex?.message || ex)); }
        });
      }

      // Judge form
      const jn = document.querySelector("#judgeName");
      const btnJudge = document.querySelector("#btnSaveJudge");
      if (jn && btnJudge){
        btnJudge.addEventListener("click", async (e)=>{
          e.preventDefault();
          const name = (jn.value||"”).trim();
          if(!name){ alert("Enter Judge name"); return; }
          try {
            const rec = await insertJudge(name);
            if (rec && rec.id){ state.lastJudge = rec.id; }
            jn.value = "";
            await refreshLists();
          } catch(ex){ alert("Save judge failed: " + (ex?.message || ex)); }
        });
      }

      await refreshLists();
    }

    document.addEventListener("DOMContentLoaded", wireLanding);
  </script>
</body>
</html>