<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    :root { --wh-header-h: 2.25in; }
    header, .header, .app-header, .site-header, #header {
      min-height: var(--wh-header-h);
      height: var(--wh-header-h);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, #e53935 0%, #fff 50%, #1e3a8a 100%);
    }
    header h1, .header h1, .app-header h1, .site-header h1, #header h1 {
      margin: 0;
      line-height: 1.1;
      color: #111;
      text-shadow: 0 1px 0 #fff3;
    }
    header img#logoLeft,
    header .left-img,
    #header img#logoLeft,
    #header .left-img,
    header img:first-of-type {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      height: calc(100% - 20px);
      width: auto;
    }
    header img.right-img,
    #header img.right-img,
    header img:last-of-type {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      height: calc(100% - 20px);
      width: auto;
    }
    body {
      margin: 0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color: #111;
      background: #fafafa;
    }
    .container {
      max-width: 1100px;
      margin: 18px auto 28px auto;
      padding: 0 14px;
    }
    .card {
      border: 1px solid #d1d5db;
      border-radius: 12px;
      padding: 14px;
      background: #fff;
      box-shadow: 0 2px 0 rgba(0,0,0,0.08);
    }
    .card + .card {
      margin-top: 16px;
    }
    .card h2 {
      margin: 0 0 10px 0;
    }
    .muted {
      color: #666;
      font-size: 12px;
    }
    .list .row {
      border-top: 1px dashed #eaeaea;
      padding: 10px 2px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .list .row:first-child {
      border-top: none;
    }
    .list .row > div:nth-child(1) {
      min-width: 200px;
    }
    .list .row .score {
      font-weight: 800;
      font-size: 22px;
      min-width: 90px;
      text-align: right;
      margin-left: auto;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border: 1px solid #bbb;
      border-radius: 8px;
      font-size: 11px;
      color: #444;
      background: #f5f5f5;
      vertical-align: middle;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #000;
      background: #e53935;
      color: #000;
      font-weight: 800;
      text-decoration: none;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    .btn:hover { filter: brightness(0.93); }
    .chip { font-size: 12px; color: #333; }
    #wholehog-nav {
      display: flex;
      gap: 10px;
      margin: 16px 0 18px 0;
      flex-wrap: wrap;
      justify-content: flex-start;
    }
    #wholehog-nav .btn {
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <header class="header">
    <img src="Legion whole hog logo.png" alt="Logo" onerror="this.style.display='none'"/>
    <h1>Leaderboard</h1>
    <img src="AL Medallion.png" alt="Logo" onerror="this.style.display='none'"/>
  </header>
  <nav id="wholehog-nav">
    <button class="btn" onclick="location.href='landing.html'">Go to Landing</button>
    <button class="btn" onclick="location.href='onsite.html'">Go to On-site</button>
    <button class="btn" onclick="location.href='blind.html'">Go to Blind Taste</button>
    <button class="btn" onclick="location.href='sauce.html'">Go to Sauce Tasting</button>
    <button class="btn" onclick="location.href='leaderboard.html'">Go to Leaderboard</button>
  </nav>
  <main class="container">
    <section class="card" id="onsite-card">
      <h2>On-site Leaders</h2>
      <div class="muted">Totals are the <strong>sum of all judges’ category points</strong>. Tie-breaker: <strong>Meat &amp; Sauce → Skin → Moisture</strong>.</div>
      <div id="onsite-list" class="list"></div>
    </section>

    <section class="card" id="division-tops-card">
      <h2>Division Leaders (On-site)</h2>
      <div class="muted">Top team from each division based on On-site totals. Uses <code>landingTeamDivisions</code>.</div>
      <div id="division-tops-list" class="list"></div>
    </section>

    <section class="card" id="blind-card">
      <h2>Blind Tasting</h2>
      <div class="muted">Totals are the <strong>sum</strong> of all judges’ blind scores (no averaging).</div>
      <div id="blind-list" class="list"></div>
    </section>

    <section class="card" id="sauce-card">
      <h2>Sauce Tasting</h2>
      <div class="muted">Totals are the <strong>sum</strong> of all judges’ sauce scores (no averaging).</div>
      <div id="sauce-list" class="list"></div>
    </section>
  </main>
  <script>
    // Utility functions for reading localStorage
    function getArr(key){ try{ return JSON.parse(localStorage.getItem(key) || '[]'); }catch{ return []; } }
    function getObj(key){ try{ return JSON.parse(localStorage.getItem(key) || '{}'); }catch{ return {}; } }
    function toInt(v){ var n=Number(v); return isFinite(n) ? Math.trunc(n) : 0; }

    // ON-SITE aggregation
    function paintOnsite(){
      const host = document.getElementById('onsite-list');
      const scores = getArr('onsiteScores');
      const teams = getArr('teams');
      const teamTotals = {};
      const meatSauce = {};
      const skin = {};
      const moisture = {};

      scores.forEach(r => {
        const team = r.team || r.name || '';
        if (!team) return;
        const sc = r.scores || {};
        const ms = toInt(sc.meatSauce || sc.meat_sauce || sc['meat and sauce'] || sc['meat&sauce'] || sc.taste || sc.flavor);
        const sk = toInt(sc.skin || sc.crackling);
        const mo = toInt(sc.moisture || sc.juiciness);
        const ap = toInt(sc.appearance || sc.visual || sc.presentation);
        const te = toInt(sc.tenderness || sc.texture);
        const total = ms + sk + mo + ap + te;
        teamTotals[team] = (teamTotals[team]||0) + total;
        meatSauce[team] = (meatSauce[team]||0) + ms;
        skin[team] = (skin[team]||0) + sk;
        moisture[team] = (moisture[team]||0) + mo;
      });

      const sorted = Object.keys(teamTotals)
        .map(team => ({
          team,
          total: teamTotals[team],
          ms: meatSauce[team] || 0,
          sk: skin[team] || 0,
          mo: moisture[team] || 0
        }))
        .sort((a,b) => b.total - a.total ||
                        b.ms - a.ms ||
                        b.sk - a.sk ||
                        b.mo - a.mo ||
                        a.team.localeCompare(b.team));

      host.innerHTML = sorted.length ?
        sorted.map((r,i) =>
          `<div class="row">
            <div><strong>${i+1}. ${r.team}</strong></div>
            <div class="score">${r.total}</div>
            <div class="badge">Meat &amp; Sauce: ${r.ms}, Skin: ${r.sk}, Moisture: ${r.mo}</div>
          </div>`
        ).join('') :
        '<div class="muted">No On-site scores yet.</div>';
    }

    // DIVISION LEADERS aggregation
    function paintDivisionTops(){
      const host = document.getElementById('division-tops-list');
      const teams = getArr('teams');
      const scores = getArr('onsiteScores');
      const divMap = getObj('landingTeamDivisions') || {};
      const teamTotals = {};
      scores.forEach(r => {
        const team = r.team || r.name || '';
        if (!team) return;
        const sc = r.scores || {};
        const ms = toInt(sc.meatSauce || sc.meat_sauce || sc['meat and sauce'] || sc['meat&sauce'] || sc.taste || sc.flavor);
        const sk = toInt(sc.skin || sc.crackling);
        const mo = toInt(sc.moisture || sc.juiciness);
        const ap = toInt(sc.appearance || sc.visual || sc.presentation);
        const te = toInt(sc.tenderness || sc.texture);
        const total = ms + sk + mo + ap + te;
        teamTotals[team] = (teamTotals[team]||0) + total;
      });

      // Find divisions
      const divisions = {};
      Object.keys(divMap).forEach(team => {
        const div = divMap[team];
        if (!divisions[div]) divisions[div] = [];
        divisions[div].push(team);
      });
      // For each division, pick the highest team
      const html = Object.keys(divisions).map(div => {
        const top = divisions[div]
          .map(team => ({team, total: teamTotals[team]||0}))
          .sort((a,b)=>b.total-a.total)[0];
        return top ? `<div class="row"><div><strong>${div}:</strong> ${top.team}</div><div class="score">${top.total}</div></div>` :
          `<div class="row"><div>${div}</div><div class="muted">No scores</div></div>`;
      }).join('');
      host.innerHTML = html || '<div class="muted">No division scores yet.</div>';
    }

    // BLIND TASTING aggregation
    function paintBlind(){
      const host = document.getElementById('blind-list');
      const entries = getArr('blindTasteEntries');
      const chips = {};
      entries.forEach(r => {
        const chip = r.chip_number || r.chip;
        if (!chip) return;
        chips[chip] = (chips[chip]||0) + toInt(r.score_total || r.score);
      });
      const sorted = Object.entries(chips)
        .sort((a,b)=>b[1]-a[1]);
      host.innerHTML = sorted.length ?
        sorted.map(([chip,score],i)=>
          `<div class="row"><div><strong>${i+1}. Chip #${chip}</strong></div><div class="score">${score}</div></div>`
        ).join('') :
        '<div class="muted">No blind tasting scores yet.</div>';
    }

    // SAUCE aggregation
    function paintSauce(){
      const host = document.getElementById('sauce-list');
      const entries = getArr('sauceScores');
      const chips = {};
      entries.forEach(r => {
        const chip = r.chip || r.chip_number;
        if (!chip) return;
        chips[chip] = (chips[chip]||0) + toInt(r.score);
      });
      const sorted = Object.entries(chips)
        .sort((a,b)=>b[1]-a[1]);
      host.innerHTML = sorted.length ?
        sorted.map(([chip,score],i)=>
          `<div class="row"><div><strong>${i+1}. Chip #${chip}</strong></div><div class="score">${score}</div></div>`
        ).join('') :
        '<div class="muted">No sauce tasting scores yet.</div>';
    }

    function paintAll(){
      paintOnsite();
      paintDivisionTops();
      paintBlind();
      paintSauce();
    }
    if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', paintAll); else paintAll();
    document.addEventListener('visibilitychange', function(){ if (!document.hidden) paintAll(); });
    window.addEventListener('storage', function(e){ paintAll(); });

  </script>
</body>
</html>